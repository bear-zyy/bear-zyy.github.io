<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>iOS蓝牙 | bear-zyy</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="https://github.com/bear-zyy/bear-zyy.github.io" title="bear-zyy" type="application/atom+xml">
    
</head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/archives" class="header__link">目录</a>
			
				<a href="https://github.com/bear-zyy/bear-zyy.github.io" class="header__link">GitHub</a>
			
		</nav>
		<h1 class="header__title"><a href="/">bear-zyy</a></h1>
		<h2 class="header__subtitle"></h2>
	</header>

	<main>
		<article>
	
		<h1>iOS蓝牙</h1>
	
	<div class="article__infos">
		<span class="article__date">2016-11-04</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-link" href="/tags/iOS/">iOS</a>
			</span>
		
	</div>

	

	
		<h1 id="ios开发之蓝牙"><a href="#ios开发之蓝牙" class="headerlink" title="ios开发之蓝牙"></a>ios开发之蓝牙</h1><h3 id="一、作为外围设备开发"><a href="#一、作为外围设备开发" class="headerlink" title="一、作为外围设备开发"></a>一、作为外围设备开发</h3><p>1、开启蓝牙会调用这个方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//peripheralManager状态改变</div><div class="line">- (void)peripheralManagerDidUpdateState:(CBPeripheralManager *)peripheral&#123;</div><div class="line">switch (peripheral.state) &#123;</div><div class="line">//在这里判断蓝牙设别的状态  当开启了则可调用  setUp方法(自定义)</div><div class="line">case CBPeripheralManagerStatePoweredOn:</div><div class="line">NSLog(@&quot;powered on&quot;); </div><div class="line">[self setUp];</div><div class="line">break; </div><div class="line">case CBPeripheralManagerStatePoweredOff:</div><div class="line">NSLog(@&quot;powered off&quot;);</div><div class="line">break; </div><div class="line">default:</div><div class="line">break;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2、打开peripheral manager ，设置它的委托<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">peripheralManager = [[CBPeripheralManager alloc]initWithDelegate:self queue:nil];</div></pre></td></tr></table></figure></p>
<p>3、创建characteristics，创建service，把characteristics 添加到service中，把service添加到peripheral manager中，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">-(void)setUp&#123;</div><div class="line">//characteristics字段描述</div><div class="line">CBUUID *CBUUIDCharacteristicUserDescriptionStringUUID = [CBUUID UUIDWithString:CBUUIDCharacteristicUserDescriptionString];</div><div class="line"></div><div class="line">/*</div><div class="line">可以通知的Characteristic</div><div class="line">properties：CBCharacteristicPropertyNotify </div><div class="line">permissions CBAttributePermissionsReadable</div><div class="line">*/</div><div class="line">CBMutableCharacteristic *notiyCharacteristic = [[CBMutableCharacteristic alloc]initWithType:[CBUUID UUIDWithString:notiyCharacteristicUUID] properties:CBCharacteristicPropertyNotify value:nil permissions:CBAttributePermissionsReadable];</div><div class="line"></div><div class="line">/*</div><div class="line">可读写的characteristics</div><div class="line">properties：CBCharacteristicPropertyWrite | CBCharacteristicPropertyRead</div><div class="line">permissions CBAttributePermissionsReadable | CBAttributePermissionsWriteable</div><div class="line">*/</div><div class="line">CBMutableCharacteristic *readwriteCharacteristic = [[CBMutableCharacteristic alloc]initWithType:[CBUUID UUIDWithString:readwriteCharacteristicUUID] properties:CBCharacteristicPropertyWrite | CBCharacteristicPropertyRead value:nil permissions:CBAttributePermissionsReadable | CBAttributePermissionsWriteable];</div><div class="line">//设置description</div><div class="line">CBMutableDescriptor *readwriteCharacteristicDescription1 = [[CBMutableDescriptor alloc]initWithType: CBUUIDCharacteristicUserDescriptionStringUUID value:@&quot;bear-zyy&quot;];</div><div class="line"></div><div class="line">[readwriteCharacteristic setDescriptors:@[readwriteCharacteristicDescription1]];</div><div class="line">/*</div><div class="line">只读的Characteristic</div><div class="line">properties：CBCharacteristicPropertyRead</div><div class="line">permissions CBAttributePermissionsReadable</div><div class="line">*/</div><div class="line">CBMutableCharacteristic *readCharacteristic = [[CBMutableCharacteristic alloc]initWithType:[CBUUID UUIDWithString:readCharacteristicUUID] properties:CBCharacteristicPropertyRead value:nil permissions:CBAttributePermissionsReadable];</div><div class="line">//service1初始化并加入两个characteristics</div><div class="line">CBMutableService *service1 = [[CBMutableService alloc]initWithType:[CBUUID UUIDWithString:ServiceUUID1] primary:YES];</div><div class="line">NSLog(@&quot;%@&quot;,service1.UUID);</div><div class="line"></div><div class="line">[service1 setCharacteristics:@[notiyCharacteristic,readwriteCharacteristic]];</div><div class="line">//    [service1 setCharacteristics:@[readwriteCharacteristic]];</div><div class="line">//service2初始化并加入一个characteristics</div><div class="line">CBMutableService *service2 = [[CBMutableService alloc]initWithType:[CBUUID UUIDWithString:ServiceUUID2] primary:YES];</div><div class="line">[service2 setCharacteristics:@[readCharacteristic]];</div><div class="line">//添加后就会调用代理的- (void)peripheralManager:(CBPeripheralManager *)peripheral didAddService:(CBService *)service error:(NSError *)error</div><div class="line">[peripheralManager addService:service1];</div><div class="line">[peripheralManager addService:service2];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4、开启广播advertising<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//perihpheral添加了service</div><div class="line">- (void)peripheralManager:(CBPeripheralManager *)peripheral didAddService:(CBService *)service error:(NSError *)error&#123;</div><div class="line">//    if (error == nil) &#123;</div><div class="line">//        serviceNum++;</div><div class="line">//    &#125;</div><div class="line">//    //因为我们添加了2个服务，所以想两次都添加完成后才去发送广播</div><div class="line">////    if (serviceNum==2) &#123;</div><div class="line">//        //添加服务后可以在此向外界发出通告 调用完这个方法后会调用代理的</div><div class="line">//        //(void)peripheralManagerDidStartAdvertising:(CBPeripheralManager *)peripheral error:(NSError *)error</div><div class="line">[peripheralManager startAdvertising:@&#123;</div><div class="line">CBAdvertisementDataServiceUUIDsKey : @[[CBUUID UUIDWithString:ServiceUUID1],[CBUUID UUIDWithString:ServiceUUID2]],</div><div class="line">CBAdvertisementDataLocalNameKey : @&quot;bear-zyy&quot;</div><div class="line">&#125;</div><div class="line">];</div><div class="line">//    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//peripheral开始发送advertising</div><div class="line">- (void)peripheralManagerDidStartAdvertising:(CBPeripheralManager *)peripheral error:(NSError *)error&#123;</div><div class="line">NSLog(@&quot;in peripheralManagerDidStartAdvertisiong&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5、对central的操作进行响应<br>5.1 读characteristics请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//读characteristics请求</div><div class="line">- (void)peripheralManager:(CBPeripheralManager *)peripheral didReceiveReadRequest:(CBATTRequest *)request&#123;</div><div class="line">NSLog(@&quot;didReceiveReadRequest&quot;);</div><div class="line">//判断是否有读数据的权限</div><div class="line">if (request.characteristic.properties &amp; CBCharacteristicPropertyRead) &#123;</div><div class="line">NSData *data = request.characteristic.value;</div><div class="line">[request setValue:data];</div><div class="line">//对请求作出成功响应</div><div class="line">[peripheralManager respondToRequest:request withResult:CBATTErrorSuccess];</div><div class="line">&#125;else&#123;</div><div class="line">[peripheralManager respondToRequest:request withResult:CBATTErrorWriteNotPermitted];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5.2写characteristics请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//写characteristics请求</div><div class="line">- (void)peripheralManager:(CBPeripheralManager *)peripheral didReceiveWriteRequests:(NSArray *)requests&#123;</div><div class="line">NSLog(@&quot;didReceiveWriteRequests&quot;);</div><div class="line">CBATTRequest *request = requests[0];</div><div class="line"></div><div class="line">//判断是否有写数据的权限</div><div class="line">if (request.characteristic.properties &amp; CBCharacteristicPropertyWrite) &#123;</div><div class="line">//需要转换成CBMutableCharacteristic对象才能进行写值</div><div class="line">CBMutableCharacteristic *c =(CBMutableCharacteristic *)request.characteristic;</div><div class="line">c.value = request.value;</div><div class="line">[peripheralManager respondToRequest:request withResult:CBATTErrorSuccess];</div><div class="line">&#125;else&#123;</div><div class="line">[peripheralManager respondToRequest:request withResult:CBATTErrorWriteNotPermitted];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>5.3订阅和取消订阅characteristics<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//订阅characteristics   当中心设备订阅了这个特征会回调这个方法</div><div class="line">-(void)peripheralManager:(CBPeripheralManager *)peripheral central:(CBCentral *)central didSubscribeToCharacteristic:(CBCharacteristic *)characteristic&#123;</div><div class="line">NSLog(@&quot;订阅了 %@的数据&quot;,characteristic.UUID);</div><div class="line">//每秒执行一次给主设备发送一个当前时间的秒数</div><div class="line">//    timer = [NSTimer scheduledTimerWithTimeInterval:2 target:self selector:@selector(sendData:) userInfo:characteristic  repeats:YES];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//取消订阅characteristics</div><div class="line">-(void)peripheralManager:(CBPeripheralManager *)peripheral central:(CBCentral *)central didUnsubscribeFromCharacteristic:(CBCharacteristic *)characteristic&#123;</div><div class="line">NSLog(@&quot;取消订阅 %@的数据&quot;,characteristic.UUID);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>二、作为中心设备</p>
<p>1、打开中心设备，设置它的委托</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">manager = [[CBCentralManager alloc]initWithDelegate:self queue:dispatch_get_main_queue()];</div></pre></td></tr></table></figure>
<p>2、扫描外围设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">-(void)centralManagerDidUpdateState:(CBCentralManager *)central&#123;</div><div class="line">switch (central.state) &#123;</div><div class="line">case CBCentralManagerStatePoweredOn:</div><div class="line">NSLog(@&quot;&gt;&gt;&gt;CBCentralManagerStatePoweredOn&quot;);</div><div class="line">//开始扫描周围的外设</div><div class="line">/*</div><div class="line">第一个参数nil就是扫描周围所有的外设，扫描到外设后会进入</div><div class="line">- (void)centralManager:(CBCentralManager *)central didDiscoverPeripheral:(CBPeripheral *)peripheral advertisementData:(NSDictionary *)advertisementData RSSI:(NSNumber *)RSSI;</div><div class="line">*/</div><div class="line">[central scanForPeripheralsWithServices:nil options:nil];</div><div class="line">break;</div><div class="line">default:</div><div class="line">break;</div><div class="line">&#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>3、把外围设备加入到中心设备中，连接外围设备</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">//扫描到设备会进入方法</div><div class="line">-(void)centralManager:(CBCentralManager *)central didDiscoverPeripheral:(CBPeripheral *)peripheral advertisementData:(NSDictionary *)advertisementData RSSI:(NSNumber *)RSSI&#123;</div><div class="line">NSLog(@&quot;当扫描到设备:%@&quot;,peripheral.name);</div><div class="line">//接下连接我们的测试设备，如果你没有设备，可以下载一个app叫lightbule的app去模拟一个设备</div><div class="line">//这里自己去设置下连接规则，我设置的是P开头的设备 </div><div class="line">//    if ([peripheral.name hasPrefix:@&quot;张&quot;])&#123;</div><div class="line">/*</div><div class="line">一个主设备最多能连7个外设，每个外设最多只能给一个主设备连接,连接成功，失败，断开会进入各自的委托</div><div class="line">- (void)centralManager:(CBCentralManager *)central didConnectPeripheral:(CBPeripheral *)peripheral;//连接外设成功的委托</div><div class="line">- (void)centra`lManager:(CBCentralManager *)central didFailToConnectPeripheral:(CBPeripheral *)peripheral error:(NSError *)error;//外设连接失败的委托</div><div class="line">- (void)centralManager:(CBCentralManager *)central didDisconnectPeripheral:(CBPeripheral *)peripheral error:(NSError *)error;//断开外设的委托</div><div class="line">*/</div><div class="line">//找到的设备必须持有它，否则CBCentralManager中也不会保存peripheral，那么CBPeripheralDelegate中的方法也不会被调用！！</div><div class="line"></div><div class="line">if ([peripheral.name isEqualToString:@&quot;外围设备名&quot;]) &#123;</div><div class="line">[discoverPeripherals addObject:peripheral];</div><div class="line">[central connectPeripheral:peripheral options:nil];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>4、设置的peripheral委托CBPeripheralDelegate 扫描外设服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">//连接到Peripherals-成功</div><div class="line">- (void)centralManager:(CBCentralManager *)central didConnectPeripheral:(CBPeripheral *)peripheral</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;&gt;&gt;&gt;连接到名称为（%@）的设备-成功&quot;,peripheral.name);</div><div class="line">//设置的peripheral委托CBPeripheralDelegate</div><div class="line">//@interface ViewController : UIViewController&lt;CBCentralManagerDelegate,CBPeripheralDelegate&gt;</div><div class="line">[peripheral setDelegate:self];</div><div class="line">//扫描外设Services，成功后会进入方法：-(void)peripheral:(CBPeripheral *)peripheral didDiscoverServices:(NSError *)error&#123;</div><div class="line">[peripheral discoverServices:nil];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>5、扫描到service</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">-(void)peripheral:(CBPeripheral *)peripheral didDiscoverServices:(NSError *)error&#123;</div><div class="line">//  NSLog(@&quot;&gt;&gt;&gt;扫描到服务：%@&quot;,peripheral.services);</div><div class="line">if (error)</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;&gt;&gt;&gt;Discovered services for %@ with error: %@&quot;, peripheral.name, [error localizedDescription]);</div><div class="line">return;</div><div class="line">&#125;</div><div class="line"></div><div class="line">CBUUID * serviceUUID = [CBUUID UUIDWithString:@&quot;服务码&quot;];</div><div class="line"></div><div class="line">//写</div><div class="line">CBUUID *characteristicUUID1=[CBUUID UUIDWithString:@&quot;特征码&quot;];</div><div class="line">//通知  读</div><div class="line">CBUUID *characteristicUUID2=[CBUUID UUIDWithString:@&quot;特征码&quot;];</div><div class="line">//写</div><div class="line">CBUUID * characteristicUU = [CBUUID UUIDWithString:@&quot;特征码&quot;];</div><div class="line">for (CBService *service in peripheral.services) &#123;</div><div class="line"></div><div class="line">[peripheral discoverCharacteristics:nil forService:service];</div><div class="line"></div><div class="line">if ([service.UUID isEqual:serviceUUID]) &#123;</div><div class="line">[peripheral discoverCharacteristics:@[characteristicUUID1,characteristicUUID2,characteristicUU] forService:service];</div><div class="line"></div><div class="line">&#125;</div><div class="line">//扫描每个service的Characteristics，扫描到后会进入方法： -(void)peripheral:(CBPeripheral *)peripheral didDiscoverCharacteristicsForService:(CBService *)service error:(NSError *)error</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>6、发现特征</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">//扫描到Characteristics</div><div class="line">-(void)peripheral:(CBPeripheral *)peripheral didDiscoverCharacteristicsForService:(CBService *)service error:(NSError *)error&#123;</div><div class="line">if (error)</div><div class="line">&#123;</div><div class="line">NSLog(@&quot;error Discovered characteristics for %@ with error: %@&quot;, service.UUID, [error localizedDescription]);</div><div class="line">return;</div><div class="line">&#125;</div><div class="line">//获取Characteristic的值，读到数据会进入方法：-(void)peripheral:(CBPeripheral *)peripheral didUpdateValueForCharacteristic:(CBCharacteristic *)characteristic error:(NSError *)error</div><div class="line">for (CBCharacteristic *characteristic in service.characteristics)&#123;</div><div class="line">&#123;</div><div class="line">[peripheral readValueForCharacteristic:characteristic];</div><div class="line">//</div><div class="line">[peripheral setNotifyValue:YES forCharacteristic:characteristic];</div><div class="line">//            if ([characteristic.UUID.UUIDString isEqualToString:@&quot;2A60&quot;]) &#123;</div><div class="line">//                NSLog(@&quot;嘿嘿&quot;);</div><div class="line">//                [peripheral writeValue:[@&quot;hahha&quot; dataUsingEncoding:NSUTF8StringEncoding] forCharacteristic:characteristic type:CBCharacteristicWriteWithResponse];</div><div class="line">//            &#125;</div><div class="line">//            [peripheral writeValue:[@&quot;看看&quot; dataUsingEncoding:NSUTF8StringEncoding] forCharacteristic:characteristic type:CBCharacteristicWriteWithResponse];</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">//搜索Characteristic的Descriptors，读到数据会进入方法：-(void)peripheral:(CBPeripheral *)peripheral didDiscoverDescriptorsForCharacteristic:(CBCharacteristic *)characteristic error:(NSError *)error</div><div class="line">for (CBCharacteristic *characteristic in service.characteristics)&#123;</div><div class="line">[peripheral discoverDescriptorsForCharacteristic:characteristic];</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>7、注册读、写、通知</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#pragma mark 搜索到Characteristic的properties</div><div class="line">-(void)peripheral:(CBPeripheral *)peripheral didDiscoverDescriptorsForCharacteristic:(CBCharacteristic *)characteristic error:(NSError *)error&#123;    </div><div class="line">if (characteristic.properties &amp; CBCharacteristicPropertyRead) &#123;</div><div class="line">//        if ([characteristic.UUID.UUIDString isEqualToString:@&quot;FFE1&quot;]) &#123;</div><div class="line">[peripheral readValueForCharacteristic:characteristic];</div><div class="line">if (characteristic.value) &#123;</div><div class="line">NSString * value=[[NSString alloc]initWithData:characteristic.value encoding:NSUTF8StringEncoding];</div><div class="line">NSLog(@&quot;读取到特征值：%@&quot;,value);</div><div class="line">//            label.text = [NSString stringWithFormat:@&quot;%@&quot;,value];</div><div class="line">&#125;</div><div class="line">//        &#125;</div><div class="line">&#125;</div><div class="line">//情景二：通知</div><div class="line">if (characteristic.properties &amp; CBCharacteristicPropertyNotify) &#123;</div><div class="line">//        if ([characteristic.UUID.UUIDString isEqualToString:@&quot;FFF1&quot;] || [characteristic.UUID.UUIDString isEqualToString:@&quot;FFF2&quot;]) &#123;</div><div class="line">//            _curCharacter = characteristic;</div><div class="line">//        label.text = @&quot;通知&quot;;</div><div class="line">[peripheral setNotifyValue:YES forCharacteristic:characteristic];</div><div class="line">&#125;</div><div class="line">//    &#125;</div><div class="line">//    //情景二：写数据</div><div class="line">if (characteristic.properties &amp; CBCharacteristicPropertyWrite) &#123;</div><div class="line">NSLog(@&quot;characteristic.UUID.UUIDString===========%@&quot;,characteristic.UUID.UUIDString);</div><div class="line">if ([characteristic.UUID.UUIDString isEqualToString:@&quot;2A60&quot;]) &#123;</div><div class="line"></div><div class="line">_sendPeripheral = peripheral;</div><div class="line">_sendCharacteristic = characteristic;</div><div class="line"></div><div class="line">[peripheral writeValue:[@&quot;2A60&quot; dataUsingEncoding:NSUTF8StringEncoding] forCharacteristic:characteristic type:CBCharacteristicWriteWithResponse];</div><div class="line"></div><div class="line">&#125;</div><div class="line">//////        //新加的</div><div class="line">if ([characteristic.UUID.UUIDString isEqualToString:@&quot;2A62&quot;]) &#123;</div><div class="line">[peripheral writeValue:[@&quot;2A62&quot; dataUsingEncoding:NSUTF8StringEncoding] forCharacteristic:characteristic type:CBCharacteristicWriteWithResponse];</div><div class="line"></div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

	

	
		<span class="different-posts"><a href="/2016/11/04/iOS蓝牙/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>hello, <br />很高兴你能来到这里，希望能对你有所帮助</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">目录</a></li>
		
		  <li class="footer-links__link"><a href="https://github.com/bear-zyy/bear-zyy.github.io">GitHub</a></li>
	    
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2017 zyy | Powered by <a href="https://hexo.io/">Hexo</a> | Theme <a href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
